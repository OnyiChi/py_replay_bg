<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Get started | ReplayBG</title><meta name="description" content="A digital twin based framework for the development and assessment of new algorithms for type 1 diabetes management">
    <link rel="preload" href="/py_replay_bg/assets/style-D6NeqhFo.css" as="style"><link rel="stylesheet" href="/py_replay_bg/assets/style-D6NeqhFo.css">
    <link rel="modulepreload" href="/py_replay_bg/assets/app-BClC6muO.js"><link rel="modulepreload" href="/py_replay_bg/assets/get_started.html-B8Nk8RgW.js">
    <link rel="prefetch" href="/py_replay_bg/assets/index.html-uQx_O2L9.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/get-started.html-BCW00GHf.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/index.html-soQffgXA.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/analyzing_replay_results.html-F92pOJ6p.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/choosing_blueprint.html-Dra4LNSj.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/data_requirements.html-C2cyaT-N.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/replaybg_object.html-BQnGwZqu.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/replaying.html-Cc5bZ2ma.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/results_folder.html-DA6G_TTC.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/twinning_procedure.html-BcnN5lvi.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/visualizing_replay_results.html-DwAb2FY0.js" as="script"><link rel="prefetch" href="/py_replay_bg/assets/404.html-B46mGNt3.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-sidebar external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/py_replay_bg/"><img class="vp-site-logo" src="https://i.postimg.cc/gJn8Sy0X/replay-bg-logo.png" alt="ReplayBG"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">ReplayBG</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/py_replay_bg/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/py_replay_bg/documentation/get_started.html" aria-label="Get started"><!---->Get started<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/py_replay_bg/documentation/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/gcappon/py_replay_bg" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/py_replay_bg/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/py_replay_bg/documentation/get_started.html" aria-label="Get started"><!---->Get started<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/py_replay_bg/documentation/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/gcappon/py_replay_bg" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="get-started" tabindex="-1"><a class="header-anchor" href="#get-started"><span>Get started</span></a></h1><h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h2><p><strong>ReplayBG</strong> can be installed via pypi by simply</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">pip install py<span class="token operator">-</span>replay<span class="token operator">-</span>bg</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="requirements" tabindex="-1"><a class="header-anchor" href="#requirements"><span>Requirements</span></a></h3><ul><li>Python &gt;= 3.11</li><li>List of Python packages in <code>requirements.txt</code></li></ul><h2 id="preparation-imports-setup-and-data-loading" tabindex="-1"><a class="header-anchor" href="#preparation-imports-setup-and-data-loading"><span>Preparation: imports, setup, and data loading</span></a></h2><p>First of all import the core modules:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> freeze_support</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, <code>os</code> will be used to manage the filesystem, <code>numpy</code> and <code>pandas</code> to manipulate and manage the data to be used, and <code>multiprocessing.freeze_support</code> to enable multiprocessing functionalities and run the twinning procedure in a faster, parallelized way.</p><p>Then, we will import the necessary ReplayBG modules:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> py_replay_bg<span class="token punctuation">.</span>py_replay_bg <span class="token keyword">import</span> ReplayBG</span>
<span class="line"><span class="token keyword">from</span> py_replay_bg<span class="token punctuation">.</span>visualizer <span class="token keyword">import</span> Visualizer</span>
<span class="line"><span class="token keyword">from</span> py_replay_bg<span class="token punctuation">.</span>analyzer <span class="token keyword">import</span> Analyzer</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, <code>ReplayBG</code> is the core ReplayBG object (more information in the <a class="route-link" href="/py_replay_bg/documentation/replaybg_object.html">The ReplayBG Object</a> page), while <code>Analyzer</code> and <code>Visualizer</code> are utility objects that will be used to respectively analyze and visualize the results that we will produce with ReplayBG (more information in the (<a class="route-link" href="/py_replay_bg/documentation/visualizing_replay_results.html">Visualizing Replay Results</a> and <a class="route-link" href="/py_replay_bg/documentation/analyzing_replay_results.html">Analyzing Replay Results</a> pages).</p><p>Next steps consist of setting up some variables that will be used by ReplayBG environment. First of all, we will run the twinning procedure in a parallelized way so let&#39;s start with:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    freeze_support<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, we will set the verbosity of ReplayBG:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">    verbose <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">    plot_mode <span class="token operator">=</span> <span class="token boolean">False</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, we need to decide what blueprint to use for twinning the data at hand.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">    blueprint <span class="token operator">=</span> <span class="token string">&#39;multi-meal&#39;</span></span>
<span class="line">    save_folder <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;..&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    parallelize <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For more information on how to choose a blueprint, please refer to the <a class="route-link" href="/py_replay_bg/documentation/choosing_blueprint.html">Choosing Blueprint</a> page.</p><p>Now, let&#39;s load some data to play with. In this example, we will use the data stored in <code>example/data/data_day_1.csv</code> which contains a day of data of a patient with T1D:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;data_day_1.csv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">.</span>t <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;t&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Be careful, data in PyReplayBG must be provided in a <code>.csv.</code> file that must follow some strict requirements. For more information see the <a href="./data_requirements">Data Requirements</a> page.</p></div><p>Let&#39;s also load the patient information (i.e., body weight and basal insulin <code>u2ss</code>) stored in the <code>example/data/patient_info.csv</code> file.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">patient_info <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;patient_info.csv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">p <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>patient_info<span class="token punctuation">[</span><span class="token string">&#39;patient&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token comment"># Set bw and u2ss</span></span>
<span class="line">bw <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>patient_info<span class="token punctuation">.</span>bw<span class="token punctuation">.</span>values<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">u2ss <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>patient_info<span class="token punctuation">.</span>u2ss<span class="token punctuation">.</span>values<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, instantiate a <code>ReplayBG</code> object:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">rbg <span class="token operator">=</span> ReplayBG<span class="token punctuation">(</span>blueprint<span class="token operator">=</span>blueprint<span class="token punctuation">,</span> save_folder<span class="token operator">=</span>save_folder<span class="token punctuation">,</span></span>
<span class="line">               yts<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> exercise<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span></span>
<span class="line">               seed<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">               verbose<span class="token operator">=</span>verbose<span class="token punctuation">,</span> plot_mode<span class="token operator">=</span>plot_mode<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="step-1-creation-of-the-digital-twin" tabindex="-1"><a class="header-anchor" href="#step-1-creation-of-the-digital-twin"><span>Step 1: Creation of the digital twin</span></a></h2><p>To create the digital twin, i.e., run the twinning procedure, using the MCMC method, use the <code>rbg.twin()</code> method:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">rbg<span class="token punctuation">.</span>twin<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> bw<span class="token operator">=</span>bw<span class="token punctuation">,</span> save_name<span class="token operator">=</span><span class="token string">&#39;data_day_1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">         twinning_method<span class="token operator">=</span><span class="token string">&#39;mcmc&#39;</span><span class="token punctuation">,</span></span>
<span class="line">         parallelize<span class="token operator">=</span>parallelize<span class="token punctuation">,</span></span>
<span class="line">         n_steps<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span></span>
<span class="line">         u2ss<span class="token operator">=</span>u2ss<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For more information on the twinning procedure see the <a class="route-link" href="/py_replay_bg/documentation/twinning_procedure.html">Twinning Procedure</a> page.</p><h2 id="step-2-run-replay-simulations" tabindex="-1"><a class="header-anchor" href="#step-2-run-replay-simulations"><span>Step 2: Run replay simulations</span></a></h2><p>Now that we have the digital twin created, it&#39;s time to replay using the <code>rbg.replay()</code> method. For more details see the <a class="route-link" href="/py_replay_bg/documentation/replaying.html">Replaying</a> page.</p><p>The possibilities are several, but for now let&#39;s just see what happens if we run a replay using the same input data used for twinning:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">replay_results <span class="token operator">=</span> rbg<span class="token punctuation">.</span>replay<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> bw<span class="token operator">=</span>bw<span class="token punctuation">,</span> save_name<span class="token operator">=</span><span class="token string">&#39;data_day_1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                            twinning_method<span class="token operator">=</span><span class="token string">&#39;mcmc&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                            save_workspace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">                            u2ss<span class="token operator">=</span>u2ss<span class="token punctuation">,</span></span>
<span class="line">                            save_suffix<span class="token operator">=</span><span class="token string">&#39;_step_2a&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It is possible to visualize the results of the simulation using:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">Visualizer<span class="token punctuation">.</span>plot_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>and analyzing the results using:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">analysis <span class="token operator">=</span> Analyzer<span class="token punctuation">.</span>analyze_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Fit MARD: %.2f %%&#39;</span> <span class="token operator">%</span> analysis<span class="token punctuation">[</span><span class="token string">&#39;median&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;twin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;mard&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Mean glucose: %.2f mg/dl&#39;</span> <span class="token operator">%</span> analysis<span class="token punctuation">[</span><span class="token string">&#39;median&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;variability&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;mean_glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As a second example, we can simulate what happens with different inputs, for example when we reduce insulin by 30%. To do that run:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">data<span class="token punctuation">.</span>bolus <span class="token operator">=</span> data<span class="token punctuation">.</span>bolus <span class="token operator">*</span> <span class="token number">.7</span></span>
<span class="line">replay_results <span class="token operator">=</span> rbg<span class="token punctuation">.</span>replay<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> bw<span class="token operator">=</span>bw<span class="token punctuation">,</span> save_name<span class="token operator">=</span>save_name<span class="token punctuation">,</span></span>
<span class="line">                            twinning_method<span class="token operator">=</span><span class="token string">&#39;mcmc&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                            save_workspace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">                            u2ss<span class="token operator">=</span>u2ss<span class="token punctuation">,</span></span>
<span class="line">                            save_suffix<span class="token operator">=</span><span class="token string">&#39;_step_2b&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Visualize results</span></span>
<span class="line">Visualizer<span class="token punctuation">.</span>plot_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># Analyze results</span></span>
<span class="line">analysis <span class="token operator">=</span> Analyzer<span class="token punctuation">.</span>analyze_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Print, for example, the average glucose</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Mean glucose: %.2f mg/dl&#39;</span> <span class="token operator">%</span> analysis<span class="token punctuation">[</span><span class="token string">&#39;median&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;variability&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;mean_glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="full-example" tabindex="-1"><a class="header-anchor" href="#full-example"><span>Full example</span></a></h2><p>A <code>.py</code> file with the full code of the get started example can be found in <code>example/code/get_started.py</code>.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> freeze_support</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> py_replay_bg<span class="token punctuation">.</span>py_replay_bg <span class="token keyword">import</span> ReplayBG</span>
<span class="line"><span class="token keyword">from</span> py_replay_bg<span class="token punctuation">.</span>visualizer <span class="token keyword">import</span> Visualizer</span>
<span class="line"><span class="token keyword">from</span> py_replay_bg<span class="token punctuation">.</span>analyzer <span class="token keyword">import</span> Analyzer</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    freeze_support<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Set verbosity</span></span>
<span class="line">    verbose <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">    plot_mode <span class="token operator">=</span> <span class="token boolean">False</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Set other parameters for twinning</span></span>
<span class="line">    blueprint <span class="token operator">=</span> <span class="token string">&#39;multi-meal&#39;</span></span>
<span class="line">    save_folder <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;..&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    parallelize <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Load data</span></span>
<span class="line">    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;data_day_1.csv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    data<span class="token punctuation">.</span>t <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;t&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Load patient_info</span></span>
<span class="line">    patient_info <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;patient_info.csv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    p <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>patient_info<span class="token punctuation">[</span><span class="token string">&#39;patient&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token comment"># Set bw and u2ss</span></span>
<span class="line">    bw <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>patient_info<span class="token punctuation">.</span>bw<span class="token punctuation">.</span>values<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    u2ss <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>patient_info<span class="token punctuation">.</span>u2ss<span class="token punctuation">.</span>values<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Instantiate ReplayBG</span></span>
<span class="line">    rbg <span class="token operator">=</span> ReplayBG<span class="token punctuation">(</span>blueprint<span class="token operator">=</span>blueprint<span class="token punctuation">,</span> save_folder<span class="token operator">=</span>save_folder<span class="token punctuation">,</span></span>
<span class="line">                   yts<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> exercise<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span></span>
<span class="line">                   seed<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">                   verbose<span class="token operator">=</span>verbose<span class="token punctuation">,</span> plot_mode<span class="token operator">=</span>plot_mode<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Set save name</span></span>
<span class="line">    save_name <span class="token operator">=</span> <span class="token string">&#39;data_day_1&#39;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Step 1. Run twinning procedure</span></span>
<span class="line">    rbg<span class="token punctuation">.</span>twin<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> bw<span class="token operator">=</span>bw<span class="token punctuation">,</span> save_name<span class="token operator">=</span>save_name<span class="token punctuation">,</span></span>
<span class="line">             twinning_method<span class="token operator">=</span><span class="token string">&#39;mcmc&#39;</span><span class="token punctuation">,</span></span>
<span class="line">             parallelize<span class="token operator">=</span>parallelize<span class="token punctuation">,</span></span>
<span class="line">             n_steps<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span></span>
<span class="line">             u2ss<span class="token operator">=</span>u2ss<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Step 2a. Replay the twin with the same input data</span></span>
<span class="line">    replay_results <span class="token operator">=</span> rbg<span class="token punctuation">.</span>replay<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> bw<span class="token operator">=</span>bw<span class="token punctuation">,</span> save_name<span class="token operator">=</span>save_name<span class="token punctuation">,</span></span>
<span class="line">                                twinning_method<span class="token operator">=</span><span class="token string">&#39;mcmc&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                save_workspace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">                                u2ss<span class="token operator">=</span>u2ss<span class="token punctuation">,</span></span>
<span class="line">                                save_suffix<span class="token operator">=</span><span class="token string">&#39;_step_2a&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Visualize results and compare with the original glucose data</span></span>
<span class="line">    Visualizer<span class="token punctuation">.</span>plot_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># Analyze results</span></span>
<span class="line">    analysis <span class="token operator">=</span> Analyzer<span class="token punctuation">.</span>analyze_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># Print, for example, the fit MARD and the average glucose</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Fit MARD: %.2f %%&#39;</span> <span class="token operator">%</span> analysis<span class="token punctuation">[</span><span class="token string">&#39;median&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;twin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;mard&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Mean glucose: %.2f mg/dl&#39;</span> <span class="token operator">%</span> analysis<span class="token punctuation">[</span><span class="token string">&#39;median&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;variability&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;mean_glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Step 2b. Replay the twin with different input data (-30% bolus insulin) to experiment how glucose changes</span></span>
<span class="line">    data<span class="token punctuation">.</span>bolus <span class="token operator">=</span> data<span class="token punctuation">.</span>bolus <span class="token operator">*</span> <span class="token number">.7</span></span>
<span class="line">    replay_results <span class="token operator">=</span> rbg<span class="token punctuation">.</span>replay<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span> bw<span class="token operator">=</span>bw<span class="token punctuation">,</span> save_name<span class="token operator">=</span>save_name<span class="token punctuation">,</span></span>
<span class="line">                                twinning_method<span class="token operator">=</span><span class="token string">&#39;mcmc&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                save_workspace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">                                u2ss<span class="token operator">=</span>u2ss<span class="token punctuation">,</span></span>
<span class="line">                                save_suffix<span class="token operator">=</span><span class="token string">&#39;_step_2b&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Visualize results</span></span>
<span class="line">    Visualizer<span class="token punctuation">.</span>plot_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># Analyze results</span></span>
<span class="line">    analysis <span class="token operator">=</span> Analyzer<span class="token punctuation">.</span>analyze_replay_results<span class="token punctuation">(</span>replay_results<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Print, for example, the average glucose</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Mean glucose: %.2f mg/dl&#39;</span> <span class="token operator">%</span> analysis<span class="token punctuation">[</span><span class="token string">&#39;median&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;variability&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;mean_glucose&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/gcappon/py_replay_bg/edit/master/docs/documentation/get_started.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: cappongiacomo@gmail.com">Giacomo Cappon</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/py_replay_bg/assets/app-BClC6muO.js" defer></script>
  </body>
</html>
